<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Il gilet di Angela</title>

  <style>
    :root { --bd:#e6e6e6; --txt:#222; --muted:#666; --r:16px; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:var(--txt);
      margin:30px;
      max-width:1100px;
      margin-inline:auto;
      line-height:1.55;
      background:#fff;
    }
    h1{margin:0 0 6px; font-size:28px;}
    p.lead{margin:0 0 18px; color:var(--muted);}
    h2{margin:26px 0 10px; font-size:18px;}
    .box{
      border:1px solid var(--bd);
      border-radius:var(--r);
      padding:16px;
      background:#fff;
      box-shadow:0 1px 0 rgba(0,0,0,.03);
    }
    label{display:block; margin-top:12px; font-weight:600; font-size:13px;}
    select,input,textarea{
      margin-top:6px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #cfcfcf;
      width:100%;
      max-width:520px;
      font-size:14px;
      background:#fff;
    }
    textarea{min-height:84px; resize:vertical;}
    .grid2{display:grid; grid-template-columns: 1fr 1fr; gap:12px;}
    .muted{color:var(--muted); font-size:12px; margin:8px 0 0;}
    .designGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
      align-items:start;
    }
    .previewCard{
      border:1px solid var(--bd);
      border-radius:12px;
      overflow:hidden;
      background:#fafafa;
    }
    .previewInner{
      position:sticky;
      top:18px;
    }
    .previewImg{
      width:280px;
      height:auto;
      display:none;
      margin:12px auto;
    }
    .previewHint{
      padding:14px;
      font-size:13px;
      color:var(--muted);
    }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border:1px solid var(--bd);
      border-radius:999px;
      font-size:12px;
      margin:10px 6px 0 0;
      color:#333;
      background:#fff;
    }
    button{
      margin-top:14px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #cfcfcf;
      background:#fff;
      cursor:pointer;
      font-size:14px;
    }
    @media (max-width: 900px){
      .designGrid{grid-template-columns:1fr;}
      .previewInner{position:relative; top:auto;}
      select,input,textarea{max-width:100%;}
    }
    .hint{
      font-size:14px;
      color:#555;
      margin-top:6px;
      font-style:italic;
    }
  </style>
</head>

<body>
  <h1>üß∂ Il gilet di Angela</h1>
  <p class="lead">Scegli le caratteristiche del tuo gilet. Io lo realizzer√≤ su misura per te ‚ù§Ô∏è</p>

  <!-- TAGLIA -->
  <h2>Taglia</h2>
  <div class="box" style="display:grid; grid-template-columns: 1fr 1fr; gap:16px; align-items:start;">
    <!-- sinistra -->
    <div>
      <label>Seleziona la taglia</label>
      <select id="size">
        <option value="" selected disabled>Scegli‚Ä¶</option>
        <option value="XS">XS</option>
        <option value="S">S</option>
        <option value="M">M</option>
      </select>

      <label>Misure precise (opzionale)</label>
      <input id="bust" type="number" placeholder="Seno (cm)">
      <input id="lengthCm" type="number" placeholder="Lunghezza desiderata (cm)">
      <p class="muted">Se inserisci misure precise, user√≤ queste per personalizzare il pattern. La taglia resta come riferimento.</p>
    </div>

    <!-- destra -->
    <div>
      <details>
        <summary style="cursor:pointer; font-weight:600;">üìè Guida alle taglie</summary>

        <div style="margin-top:10px; overflow:auto; border:1px solid #e5e5e5; border-radius:12px;">
          <table style="border-collapse:collapse; width:100%; min-width:480px;">
            <thead>
              <tr style="background:#f7f7f7;">
                <th style="padding:10px; text-align:left;">Taglia</th>
                <th style="padding:10px; text-align:left;">Misura busto (persona)</th>
                <th style="padding:10px; text-align:left;">Circonferenza busto Regular (capo)</th>
                <th style="padding:10px; text-align:left;">Circonferenza busto Oversize (capo)</th>
              </tr>
            </thead>
            <tbody>
              <tr id="row-XS">
                <td style="padding:10px;">XS</td>
                <td style="padding:10px;">80‚Äì85 cm</td>
                <td style="padding:10px;">90 cm</td>
                <td style="padding:10px;">100 cm</td>
              </tr>
              <tr id="row-S">
                <td style="padding:10px;">S</td>
                <td style="padding:10px;">85‚Äì90 cm</td>
                <td style="padding:10px;">95 cm</td>
                <td style="padding:10px;">105 cm</td>
              </tr>
              <tr id="row-M">
                <td style="padding:10px;">M</td>
                <td style="padding:10px;">90‚Äì95 cm</td>
                <td style="padding:10px;">100 cm</td>
                <td style="padding:10px;">110 cm</td>
              </tr>
            </tbody>
          </table>
        </div>

        <p class="muted">
          La misura busto √® la circonferenza del torace della persona. Le altre colonne indicano la circonferenza del gilet finito.
        </p>
      </details>
    </div>
  </div>

  <!-- DESIGN -->
  <h2>Design</h2>
  <div class="box">
    <div class="designGrid">

      <!-- SINISTRA: menu -->
      <div>
        <label>Fit</label>
        <select id="fit">
          <option value="" selected disabled>Scegli‚Ä¶</option>
          <option value="regular">Regular</option>
          <option value="oversized">Oversized</option>
        </select>

        <label>Lunghezza</label>
        <select id="len">
          <option value="" selected disabled>Scegli‚Ä¶</option>
          <option value="regular">Regular</option>
          <option value="cropped">Cropped</option>
        </select>
        <p class="muted">Se vuoi una lunghezza specifica, scrivila nella sezione ‚ÄúTaglia / Misure precise‚Äù.</p>

        <label>Colletto</label>
        <select id="neck">
          <option value="" selected disabled>Scegli‚Ä¶</option>
          <option value="v">V-neck</option>
          <option value="crew">Crew neck</option>
          <option value="other">Altro (scrivi sotto)</option>
        </select>

        <label>Note colletto (solo se ‚ÄúAltro‚Äù)</label>
        <input id="neckNotes" type="text" placeholder="es. V pi√π profonda / bordo pi√π alto / ecc.">
      </div>

      <!-- DESTRA: preview -->
      <div class="previewInner">
        <div class="previewCard">
          <img id="previewImg" class="previewImg" alt="Anteprima gilet">
          <div id="previewHint" class="previewHint">
            Seleziona Fit (e poi Lunghezza + Colletto) per vedere l‚Äôanteprima ‚ú®
          </div>
        </div>

        <div>
          <span class="pill" id="pill1">Fit: ‚Äî</span>
          <span class="pill" id="pill2">Lunghezza: ‚Äî</span>
          <span class="pill" id="pill3">Colletto: ‚Äî</span>
        </div>

        <p id="imgPath" class="muted" style="margin-top:10px;"></p>
      </div>
    </div>
  </div>

  <!-- DETTAGLI -->
  <h2>Dettagli</h2>
  <div class="box">
    <div class="grid2">
      <div>
        <label>Tipo di rib sui bordi</label>
        <select id="rib">
          <option value="" selected>Scegli...</option>
          <option value="1x1">Rib 1x1</option>
          <option value="2x2">Rib 2x2</option>
          <option value="twisted">Rib twisted</option>
        </select>
        <p id="ribDesc" class="hint"></p>
      </div>

      <div>
        <label>Lunghezza rib</label>
        <select id="ribLen">
          <option value="" selected disabled>Scegli‚Ä¶</option>
          <option value="corta">Corta</option>
          <option value="lunga">Lunga</option>
        </select>
      </div>
    </div>

    <label>Slit laterali</label>
    <select id="slit">
      <option value="" selected disabled>Scegli‚Ä¶</option>
      <option value="no">No</option>
      <option value="si">S√¨</option>
    </select>
  </div>

  <!-- LANA -->
  <h2>Lana e colore</h2>
  <div class="box">
    <div class="designGrid">
      <!-- sinistra -->
      <div>
        <label>Filato</label>
        <select id="yarn">
          <option value="" selected disabled>Scegli‚Ä¶</option>
          <option value="baby">DROPS Baby Merino ‚Äî fine, morbida, elastica (look pulito)</option>
          <option value="lima">DROPS Lima ‚Äî lana+alpaca, caldo e ‚Äúadulto‚Äù, ottima caduta</option>
          <option value="air">DROPS Air ‚Äî soffice e leggero, effetto ‚Äúnuvola‚Äù</option>
          <option value="alpaca">DROPS Alpaca ‚Äî come il mio cardigan violetto: drape, cade molto</option>
          <option value="puna">DROPS Puna ‚Äî molto morbida, look ‚Äúpremium‚Äù, ottima per un gilet caldo ma elegante</option>
          <option value="karisma">DROPS Karisma ‚Äî lana classica e resistente, tiene la forma (pi√π ‚Äústrutturata‚Äù)</option>
        </select>

        <p class="muted" style="margin-top:10px;">
          <a id="yarnLink" href="#" target="_blank" rel="noopener noreferrer" style="display:none;">
            üîó Scegli il colore del filato
          </a>
        </p>

        <label>Colore scelto (scrivilo qui)</label>
        <input id="color" type="text" placeholder="es. 17, Misty Blue / panna / grigio fumo‚Ä¶">
        <p class="muted">Poi copia qui il nome/codice colore (es. 17, Misty Blue).</p>
      </div>

      <!-- destra -->
      <div class="previewInner">
        <div class="previewCard">
          <img id="yarnImg" class="previewImg" alt="Anteprima filato">
          <div id="yarnHint" class="previewHint">Seleziona un filato per vedere l‚Äôanteprima üß∂</div>
        </div>
        <p id="yarnImgPath" class="muted" style="margin-top:10px;"></p>
      </div>
    </div>
  </div>

  <!-- CONFERMA -->
  <div class="box" style="margin-top:18px;">
    <button id="submitBtn">Conferma e genera riepilogo</button>
    <p class="muted">Alla conferma si apre una finestra con testo copiabile e file scaricabile.</p>
  </div>

  <!-- MODAL -->
  <div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); padding:18px;">
    <div style="max-width:560px; margin:10vh auto; background:#fff; border-radius:16px; padding:16px; border:1px solid #e5e5e5;">
      <h3 style="margin:0 0 8px;">Decisione completata üíõ</h3>
      <p style="margin:0 0 12px; color:#555;">Perfetto! Ora copia il riepilogo e mandamelo.</p>

      <textarea id="finalSummary" style="width:100%; min-height:210px; padding:10px; border-radius:12px; border:1px solid #ddd;"></textarea>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
  <button id="copyFinal">Copia testo</button>
  <button id="downloadFinal">Scarica file</button>
  <button id="waBtn">Invia su WhatsApp</button>
  <button id="closeModal">Chiudi</button>
</div>

<p class="muted" style="margin-top:10px;">
  Decisa? Scelta confermata? üòå Clicca ‚ÄúInvia su WhatsApp‚Äù e mandami il messaggio.
</p>


     
    </div>
  </div>

  <script>
    // -------------------------
    // 1) HIGHLIGHT TAGLIA
    // -------------------------
    const sizeSelect = document.getElementById("size");
    function highlightRow(){
      ["XS","S","M"].forEach(s => {
        const row = document.getElementById("row-" + s);
        if(row) row.style.background = "";
      });
      const selected = sizeSelect.value;
      const selectedRow = document.getElementById("row-" + selected);
      if(selectedRow) selectedRow.style.background = "#f3f6ff";
    }
    sizeSelect.addEventListener("change", highlightRow);

    // -------------------------
    // 2) PREVIEW DINAMICA (progressiva) - DESIGN
    // -------------------------
    const fitSelect  = document.getElementById("fit");
    const lenSelect  = document.getElementById("len");
    const neckSelect = document.getElementById("neck");
    const neckNotes  = document.getElementById("neckNotes");

    const previewImg  = document.getElementById("previewImg");
    const previewHint = document.getElementById("previewHint");
    const imgPath     = document.getElementById("imgPath");

    const pill1 = document.getElementById("pill1");
    const pill2 = document.getElementById("pill2");
    const pill3 = document.getElementById("pill3");

    function updatePills(){
      pill1.textContent = `Fit: ${fitSelect.value || "‚Äî"}`;
      pill2.textContent = `Lunghezza: ${lenSelect.value || "‚Äî"}`;
      pill3.textContent = `Colletto: ${neckSelect.value || "‚Äî"}`;
    }

    function chooseFilename(){
      const fit  = fitSelect.value;     // regular / oversized
      const len  = lenSelect.value;     // regular / cropped
      const neck = neckSelect.value;    // v / crew / other

      if(!fit) return null;
      if(!len) return `${fit}.jpg`;
      if(!neck) return `${fit}_${len}.jpg`;
      if(neck === "other") return `${fit}_${len}.jpg`;
      return `${fit}_${len}_${neck}.jpg`;
    }

    function updatePreview(){
      updatePills();

      const fit = fitSelect.value;
      if(!fit){
        previewImg.style.display = "none";
        previewHint.style.display = "block";
        previewHint.textContent = "Seleziona Fit (e poi Lunghezza + Colletto) per vedere l‚Äôanteprima ‚ú®";
        imgPath.textContent = "";
        return;
      }

      const filename = chooseFilename();
      const path = `img/${filename}`;

      if(neckSelect.value === "other"){
        previewHint.textContent = "Colletto personalizzato: descrivilo nel campo note üíõ (anteprima basata su Fit + Lunghezza)";
      } else {
        previewHint.textContent = "Seleziona Fit (e poi Lunghezza + Colletto) per vedere l‚Äôanteprima ‚ú®";
      }

      previewImg.src = path;
      previewImg.style.display = "block";
      previewHint.style.display = "none";
      imgPath.textContent = `Anteprima: ${path}`;
    }

    previewImg.addEventListener("error", () => {
      previewImg.style.display = "none";
      previewHint.style.display = "block";
      previewHint.textContent = "Immagine non trovata per questa combinazione (controlla i nomi in img/).";
      imgPath.textContent = "";
    });

    [fitSelect, lenSelect, neckSelect, neckNotes].forEach(el => {
      el.addEventListener("change", updatePreview);
      el.addEventListener("input", updatePreview);
    });

    // -------------------------
    // 3) DESCRIZIONE RIB
    // -------------------------
    const rib = document.getElementById("rib");
    const ribDesc = document.getElementById("ribDesc");

    rib.addEventListener("change", () => {
      const val = rib.value;

      if(val === "1x1"){
        ribDesc.textContent = "Classico, pulito ed elegante. Tiene bene la forma ed √® adatto a uno stile minimal.";
      }
      else if(val === "2x2"){
        ribDesc.textContent = "Pi√π morbido e visibile. Dona un effetto pi√π rilassato e leggermente pi√π elastico.";
      }
      else if(val === "twisted"){
        ribDesc.textContent = "Pi√π compatto ed elastico. Il bordo resta definito nel tempo e d√† un effetto pi√π raffinato.";
      }
      else{
        ribDesc.textContent = "";
      }
    });

    // -------------------------
    // 4) PREVIEW FILATO + LINK
    // -------------------------
    const yarnSelect = document.getElementById("yarn");
    const yarnImg = document.getElementById("yarnImg");
    const yarnHint = document.getElementById("yarnHint");
    const yarnImgPath = document.getElementById("yarnImgPath");
    const yarnLink = document.getElementById("yarnLink");

    const YARN_URL = {
      baby: "https://lindehobby.it/drops-128/drops-baby-merino-p108?_gl=1*vr8sjl*_up*MQ..*_gs*MQ..&gclid=Cj0KCQiA-YvMBhDtARIsAHZuUzIEIcjAJaFt5XEfnfi72xItZiT_9VJi3eHH0TppDfVHSfo6hkRDR8caAm5FEALw_wcB&gbraid=0AAAAAodwrBoYYctz1KInYCjUQ8wNzQAzq",
      lima: "https://lindehobby.it/filato-127/drops-lima-p130?_gl=1*vr8sjl*_up*MQ..*_gs*MQ..&gclid=Cj0KCQiA-YvMBhDtARIsAHZuUzIEIcjAJaFt5XEfnfi72xItZiT_9VJi3eHH0TppDfVHSfo6hkRDR8caAm5FEALw_wcB&gbraid=0AAAAAodwrBoYYctz1KInYCjUQ8wNzQAzq",
      air: "https://lindehobby.it/drops-128/drops-air-p106?_gl=1*1mygi4u*_up*MQ..*_gs*MQ..&gclid=Cj0KCQiA-YvMBhDtARIsAHZuUzIEIcjAJaFt5XEfnfi72xItZiT_9VJi3eHH0TppDfVHSfo6hkRDR8caAm5FEALw_wcB&gbraid=0AAAAAodwrBoYYctz1KInYCjUQ8wNzQAzq",
      alpaca: "https://lindehobby.it/drops-128/drops-alpaca-p215?_gl=1*105tp2*_up*MQ..*_gs*MQ..&gclid=Cj0KCQiA-YvMBhDtARIsAHZuUzIEIcjAJaFt5XEfnfi72xItZiT_9VJi3eHH0TppDfVHSfo6hkRDR8caAm5FEALw_wcB&gbraid=0AAAAAodwrBoYYctz1KInYCjUQ8wNzQAzq",
      puna: "https://lindehobby.it/drops-128/drops-puna-p635?_gl=1*19y0jq1*_up*MQ..*_gs*MQ..&gclid=Cj0KCQiA-YvMBhDtARIsAHZuUzIEIcjAJaFt5XEfnfi72xItZiT_9VJi3eHH0TppDfVHSfo6hkRDR8caAm5FEALw_wcB&gbraid=0AAAAAodwrBoYYctz1KInYCjUQ8wNzQAzq",
      karisma: "https://lindehobby.it/drops-128/drops-karisma-p119?gad_source=1&gad_campaignid=22217859980&gbraid=0AAAAAodwrBoYYctz1KInYCjUQ8wNzQAzq&gclid=Cj0KCQiA-YvMBhDtARIsAHZuUzIEIcjAJaFt5XEfnfi72xItZiT_9VJi3eHH0TppDfVHSfo6hkRDR8caAm5FEALw_wcB#vid:908",
    };

    function updateYarnPreview(){
      const y = yarnSelect.value;

      if(!y){
        yarnImg.style.display = "none";
        yarnHint.style.display = "block";
        yarnHint.textContent = "Seleziona un filato per vedere l‚Äôanteprima üß∂";
        yarnLink.style.display = "none";
        yarnImgPath.textContent = "";
        return;
      }

      const filename = `${y}.jpg`;
      const path = `img/${filename}`;
      yarnImg.src = path;
      yarnImg.style.display = "block";
      yarnHint.style.display = "none";
      yarnImgPath.textContent = `Anteprima: ${path}`;

      const url = YARN_URL[y];
      if(url){
        yarnLink.href = url;
        yarnLink.style.display = "inline";
      } else {
        yarnLink.style.display = "none";
      }
    }

    yarnImg.addEventListener("error", () => {
      yarnImg.style.display = "none";
      yarnHint.style.display = "block";
      yarnHint.textContent = "Immagine filato non trovata (controlla i nomi in img/).";
      yarnImgPath.textContent = "";
    });

    yarnSelect.addEventListener("change", updateYarnPreview);

    // -------------------------
    // 5) MODAL + RIEPILOGO + DOWNLOAD
    // -------------------------
    const bust = document.getElementById("bust");
    const lengthCm = document.getElementById("lengthCm");

    const ribLen  = document.getElementById("ribLen");
    const slit    = document.getElementById("slit");

    const yarn  = document.getElementById("yarn");
    const color = document.getElementById("color");

    const submitBtn = document.getElementById("submitBtn");
    const modal = document.getElementById("modal");
    const finalSummary = document.getElementById("finalSummary");
    const copyFinal = document.getElementById("copyFinal");
    const downloadFinal = document.getElementById("downloadFinal");
    const closeModal = document.getElementById("closeModal");
    const waBtn = document.getElementById("waBtn");


    function labelOf(selectEl){
      const i = selectEl.selectedIndex;
      if(i < 0) return "‚Äî";
      const opt = selectEl.options[i];
      return opt ? opt.text : "‚Äî";
    }

    function buildSummary(){
      const sizeTxt = sizeSelect.value || "‚Äî";
      const bustTxt = bust.value ? `${bust.value} cm` : "‚Äî";
      const lenCmTxt = lengthCm.value ? `${lengthCm.value} cm` : "‚Äî";

      const fitTxt = fitSelect.value || "‚Äî";
      const lenTxt = lenSelect.value || "‚Äî";
      const neckTxt = neckSelect.value || "‚Äî";
      const neckNoteTxt = (neckSelect.value === "other" && neckNotes.value.trim()) ? neckNotes.value.trim() : "‚Äî";

      const ribTxt = rib.value || "‚Äî";
      const ribLenTxt  = ribLen.value || "‚Äî";
      const slitTxt    = slit.value || "‚Äî";

      const yarnTxt  = yarn.value ? labelOf(yarn) : "‚Äî";
      const colorTxt = color.value.trim() ? color.value.trim() : "‚Äî";

      const preview = chooseFilename() ? `img/${chooseFilename()}` : "‚Äî";

      return `Scelte gilet (Angela)
TAGLIA
- Taglia: ${sizeTxt}
- Seno (opzionale): ${bustTxt}
- Lunghezza desiderata (opzionale): ${lenCmTxt}

DESIGN
- Fit: ${fitTxt}
- Lunghezza: ${lenTxt}
- Colletto: ${neckTxt}
- Note colletto (se Altro): ${neckNoteTxt}

DETTAGLI
- Rib (bordi): ${ribTxt}
- Lunghezza rib: ${ribLenTxt}
- Slit laterali: ${slitTxt}

LANA E COLORE
- Filato: ${yarnTxt}
- Colore: ${colorTxt}

Anteprima usata: ${preview}`;
    }

    submitBtn.addEventListener("click", () => {
      if(!fitSelect.value){
        alert("Scegli almeno il Fit üôÇ");
        return;
      }
      finalSummary.value = buildSummary();
      modal.style.display = "block";
    });
waBtn.addEventListener("click", () => {
  const text = finalSummary.value || buildSummary(); // usa quello gi√† nel box
  const waUrl = "https://wa.me/?text=" + encodeURIComponent(text);
  window.open(waUrl, "_blank");
});

    closeModal.addEventListener("click", () => modal.style.display = "none");
    modal.addEventListener("click", (e) => { if(e.target === modal) modal.style.display = "none"; });

    copyFinal.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(finalSummary.value);
        const old = copyFinal.textContent;
        copyFinal.textContent = "Copiato ‚úÖ";
        setTimeout(()=> copyFinal.textContent = old, 1200);
      } catch {
        alert("Copia non riuscita. Seleziona e copia manualmente.");
      }
    });

    downloadFinal.addEventListener("click", () => {
      const blob = new Blob([finalSummary.value], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "scelte-gilet-angela.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // init
    updatePills();
    updatePreview();
    updateYarnPreview();
  </script>

</body>
</html>

